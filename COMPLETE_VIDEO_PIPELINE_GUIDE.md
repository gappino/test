# راهنمای کامل سیستم تولید ویدیو با کوکورو و زیرنویس

## نمای کلی سیستم

این سیستم یک پلتفرم کامل برای تولید ویدیوهای هوش مصنوعی است که شامل موارد زیر می‌باشد:

1. **تولید اسکریپت** با Gemini AI
2. **تولید تصاویر** با Pollinations.ai
3. **تولید صدا** با Kokoro TTS (واقعی)
4. **تولید زیرنویس** با Whisper
5. **ترکیب ویدیو** با FFmpeg و زیرنویس

## ویژگی‌های جدید

### 1. ادغام واقعی Kokoro TTS
- استفاده از اسکریپت `kokoro_real_tts.py` به جای pyttsx3
- پشتیبانی از صداهای مختلف کوکورو
- کیفیت صدا بالا با نرخ نمونه‌برداری 24kHz

### 2. هماهنگی دقیق صدا و تصویر
- مدت زمان هر صحنه دقیقاً برابر با مدت زمان صدا
- سنکرونیزاسیون کامل بین تصاویر و صدا
- پشتیبانی از مدت زمان‌های مختلف برای هر صحنه

### 3. تولید زیرنویس خودکار
- استفاده از Whisper برای تشخیص گفتار
- تولید زیرنویس با زمان‌بندی دقیق
- قرار دادن زیرنویس روی ویدیو نهایی

### 4. رابط کاربری بهبود یافته
- نمایش صداهای تولید شده برای هر صحنه
- امکان پخش صدا قبل از تولید ویدیو نهایی
- نمایش اطلاعات کامل صدا (صدا، موتور، مدت زمان)

## نحوه استفاده

### مرحله 1: تولید اسکریپت
1. روی دکمه "شروع تولید محتوا" کلیک کنید
2. سیستم با Gemini AI اسکریپت ویدیو را تولید می‌کند
3. اسکریپت شامل صحنه‌ها، متن گوینده و توضیحات بصری است

### مرحله 2: تولید تصاویر
1. روی دکمه "تولید تصاویر" کلیک کنید
2. برای هر صحنه پرامپت تصویر تولید می‌شود
3. تصاویر با Pollinations.ai تولید می‌شوند
4. پیشرفت تولید نمایش داده می‌شود

### مرحله 3: تولید صدا و ویدیو
1. روی دکمه "تولید ویدیو کامل" کلیک کنید
2. سیستم مراحل زیر را انجام می‌دهد:
   - تولید صدا برای هر صحنه با Kokoro TTS
   - تولید زیرنویس با Whisper
   - ترکیب تصاویر، صدا و زیرنویس
   - تولید ویدیو نهایی

## تنظیمات صدا

### صداهای موجود در Kokoro:
- `af_heart`: صدای زن آمریکایی - Heart
- `af_bella`: صدای زن آمریکایی - Bella
- `af_jessica`: صدای زن آمریکایی - Jessica
- `af_sarah`: صدای زن آمریکایی - Sarah
- `am_adam`: صدای مرد آمریکایی - Adam
- `am_eric`: صدای مرد آمریکایی - Eric
- `am_michael`: صدای مرد آمریکایی - Michael
- `am_liam`: صدای مرد آمریکایی - Liam
- `bf_alice`: صدای زن بریتانیایی - Alice
- `bf_emma`: صدای زن بریتانیایی - Emma
- `bm_daniel`: صدای مرد بریتانیایی - Daniel
- `bm_george`: صدای مرد بریتانیایی - George

## API Endpoints

### Kokoro TTS
- `POST /api/kokoro/text-to-speech`: تولید صدا
- `GET /api/kokoro/voices`: دریافت لیست صداها
- `GET /api/kokoro/health`: بررسی وضعیت سرویس

### Video Generation
- `POST /api/video/generate-complete-video`: تولید ویدیو کامل
- `GET /api/video/status/:videoId`: وضعیت تولید ویدیو

### Remotion (Video Composition)
- `POST /api/remotion/compose-video-with-subtitles`: ترکیب ویدیو با زیرنویس
- `GET /api/remotion/download/:filename`: دانلود ویدیو

### Whisper
- `POST /api/whisper/transcribe-with-timestamps`: تشخیص گفتار با زمان‌بندی
- `POST /api/whisper/generate-subtitles`: تولید زیرنویس

## فایل‌های مهم

### Backend
- `routes/kokoro.js`: مدیریت Kokoro TTS
- `routes/video.js`: مدیریت تولید ویدیو
- `routes/remotion.js`: ترکیب ویدیو و زیرنویس
- `routes/whisper.js`: تشخیص گفتار و زیرنویس
- `kokoro_real_tts.py`: اسکریپت Python برای Kokoro

### Frontend
- `public/index.html`: رابط کاربری اصلی
- `public/script.js`: منطق JavaScript
- `public/styles.css`: استایل‌ها

## پیش‌نیازها

### نرم‌افزارهای مورد نیاز:
- Node.js و npm
- Python 3.8+
- FFmpeg
- Kokoro TTS (نصب شده)

### پکیج‌های Python:
- kokoro
- soundfile
- torch
- numpy

### پکیج‌های Node.js:
- express
- fluent-ffmpeg
- multer
- axios
- fs-extra

## عیب‌یابی

### مشکلات رایج:

1. **خطا در تولید صدا:**
   - بررسی نصب Kokoro
   - بررسی دسترسی به فایل‌های صدا
   - بررسی فضای دیسک

2. **خطا در تولید زیرنویس:**
   - بررسی نصب Whisper
   - بررسی کیفیت فایل صوتی
   - بررسی زبان تشخیص

3. **خطا در ترکیب ویدیو:**
   - بررسی نصب FFmpeg
   - بررسی دسترسی به فایل‌های موقت
   - بررسی فضای دیسک

### لاگ‌ها:
- لاگ‌های سرور در کنسول Node.js
- لاگ‌های Python در stderr
- لاگ‌های FFmpeg در فایل‌های موقت

## بهبودهای آینده

1. **پشتیبانی از زبان‌های بیشتر**
2. **تنظیمات پیشرفته زیرنویس**
3. **پشتیبانی از موسیقی پس‌زمینه**
4. **افکت‌های انتقال بین صحنه‌ها**
5. **پشتیبانی از ویدیوهای طولانی‌تر**

## پشتیبانی

برای گزارش مشکلات یا درخواست ویژگی‌های جدید، لطفاً:
1. لاگ‌های مربوطه را جمع‌آوری کنید
2. مراحل تولید مشکل را شرح دهید
3. اطلاعات سیستم را ارائه دهید

---

**نکته:** این سیستم برای تولید ویدیوهای کوتاه تا متوسط طراحی شده است. برای ویدیوهای طولانی، ممکن است نیاز به بهینه‌سازی باشد.


